<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gym Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #131314; 
            color: #e3e3e3;
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        .input-control-btn {
            background: #28292c;
            border: 1px solid #3c4043;
            border-radius: 14px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #e3e3e3;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-control-btn:active {
            background: #3c4043;
            transform: scale(0.92);
        }

        .glass-header {
            background: rgba(19, 19, 20, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid #28292c;
        }

        .dark-card {
            background: #1e1f20;
            border: 1px solid #28292c;
        }

        .planner-input {
            background: #131314;
            border: 1px solid #3c4043;
            border-radius: 8px;
            color: #e3e3e3;
            font-weight: 700;
            text-align: center;
            font-size: 12px;
            padding: 4px 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const VERSION = "v1.2.2"; 

        const CONSTANTS = {
            EXERCISE_DB_ID: '2b3fe23d5e3c8011ac26d67c56e8309f',
            LOG_DB_ID: '313fe23d5e3c80e384b9c7b5f9917e84'
        };

        const Icons = {
            Logo: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="9" width="4" height="6" rx="2" fill="#8ab4f8"/>
                    <rect x="18" y="9" width="4" height="6" rx="2" fill="#8ab4f8"/>
                    <path d="M6 12H18" stroke="#8ab4f8" strokeWidth="3" strokeLinecap="round"/>
                    <circle cx="12" cy="12" r="2" fill="#e3e3e3"/>
                </svg>
            ),
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [routines, setRoutines] = useState(JSON.parse(localStorage.getItem('gym_routines') || '[]'));
            const [activeRoutine, setActiveRoutine] = useState(null);
            const [currentExerciseIndex, setCurrentExerciseIndex] = useState(0);
            const [workoutLog, setWorkoutLog] = useState({});
            
            const [inputWeight, setInputWeight] = useState(0);
            const [inputReps, setInputReps] = useState(10);
            
            const [timerActive, setTimerActive] = useState(false);
            const [timeLeft, setTimeLeft] = useState(0);
            const [targetEndTime, setTargetEndTime] = useState(null);
            
            const [notionKey, setNotionKey] = useState(localStorage.getItem('notion_key') || '');
            const [notionExercises, setNotionExercises] = useState(JSON.parse(localStorage.getItem('notion_exercises_cache') || '[]'));
            const [syncStatus, setSyncStatus] = useState('idle');
            const [isLogging, setIsLogging] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [showConfirmDelete, setShowConfirmDelete] = useState(false);

            const timerRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('gym_routines', JSON.stringify(routines));
            }, [routines]);

            // Robust Active Pre-fill Logic
            useEffect(() => {
                if (view === 'active' && activeRoutine) {
                    const ex = activeRoutine.exercises[currentExerciseIndex];
                    const logs = workoutLog[ex.id] || [];
                    
                    if (logs.length > 0) {
                        // If we just finished a set, keep that weight/rep as default for next set
                        setInputWeight(logs[logs.length-1].w);
                        setInputReps(logs[logs.length-1].r);
                    } else {
                        // New exercise in session: use values configured in Planner
                        setInputWeight(ex.suggestedWeight || 0);
                        setInputReps(ex.targetReps || 10);
                    }
                }
            }, [currentExerciseIndex, view, activeRoutine]);

            const deleteRoutine = () => {
                const updated = routines.filter(r => r.id !== activeRoutine.id);
                setRoutines(updated);
                setView('home');
                setShowConfirmDelete(false);
            };

            const fetchExercisesFromNotion = async () => {
                if (!notionKey) { setErrorMessage("API Key required."); setSyncStatus('error'); return; }
                setSyncStatus('syncing');
                try {
                    const proxyUrl = "https://cors-anywhere.herokuapp.com/"; 
                    const response = await fetch(proxyUrl + `https://api.notion.com/v1/databases/${CONSTANTS.EXERCISE_DB_ID}/query`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${notionKey}`, 'Notion-Version': '2022-06-28', 'Content-Type': 'application/json' },
                        body: JSON.stringify({ filter: { property: "Routine", select: { is_not_empty: true } } })
                    });
                    if (!response.ok) throw new Error("Auth failed.");
                    const data = await response.json();
                    const fetched = data.results.map(page => {
                        const p = page.properties;
                        const getText = (prop) => {
                            if (!prop) return "";
                            if (prop.type === 'title') return prop.title[0]?.plain_text || "";
                            if (prop.type === 'rich_text') return prop.rich_text[0]?.plain_text || "";
                            if (prop.type === 'number') return prop.number?.toString() || "";
                            return "";
                        };
                        const weightVal = getText(p["Weight"]);
                        let baseWeight = 0;
                        if (weightVal) {
                            const numbers = weightVal.split(/[- ,]/).map(v => parseFloat(v.trim())).filter(n => !isNaN(n));
                            if (numbers.length > 0) baseWeight = Math.min(...numbers);
                        }
                        const parseNum = (s, f) => { const m = String(s).match(/\d+/); return m ? parseInt(m[0]) : f; };
                        return {
                            id: page.id,
                            name: getText(p["Exercise Name"]) || "Untitled",
                            tag: p["Routine"]?.select?.name || "",
                            sets: parseNum(getText(p["Sets"]), 3),
                            pause: parseNum(getText(p["Pause"]), 90),
                            weight: baseWeight
                        };
                    }).filter(ex => ex.name !== "Untitled");
                    setNotionExercises(fetched);
                    localStorage.setItem('notion_exercises_cache', JSON.stringify(fetched));
                    setSyncStatus('success');
                    setTimeout(() => setSyncStatus('idle'), 2000);
                } catch (err) { setSyncStatus('error'); setErrorMessage(err.message); }
            };

            const pushToNotionLog = async () => {
                if (!notionKey) return;
                setIsLogging(true);
                const proxyUrl = "https://cors-anywhere.herokuapp.com/"; 
                const today = new Date().toISOString().split('T')[0];
                for (const exId in workoutLog) {
                    const exercise = activeRoutine.exercises.find(e => e.id.toString() === exId.toString());
                    if (!exercise) continue;
                    for (const set of workoutLog[exId]) {
                        try {
                            await fetch(proxyUrl + "https://api.notion.com/v1/pages", {
                                method: 'POST',
                                headers: { 'Authorization': `Bearer ${notionKey}`, 'Notion-Version': '2022-06-28', 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },
                                body: JSON.stringify({
                                    parent: { database_id: CONSTANTS.LOG_DB_ID },
                                    properties: {
                                        "Exercise": { title: [{ text: { content: exercise.name } }] },
                                        "Date": { date: { start: today } },
                                        "Weight": { number: parseFloat(set.w) || 0 },
                                        "Reps": { number: parseInt(set.r) || 0 }
                                    }
                                })
                            });
                        } catch (e) { console.error(e); }
                    }
                }
                setIsLogging(false);
            };

            const startTimer = (seconds) => {
                setTargetEndTime(Date.now() + (seconds * 1000));
                setTimeLeft(seconds);
                setTimerActive(true);
            };

            useEffect(() => {
                if (timerActive && targetEndTime) {
                    timerRef.current = setInterval(() => {
                        const remaining = Math.max(0, Math.ceil((targetEndTime - Date.now()) / 1000));
                        setTimeLeft(remaining);
                        if (remaining <= 0) { setTimerActive(false); setTargetEndTime(null); }
                    }, 500);
                }
                return () => clearInterval(timerRef.current);
            }, [timerActive, targetEndTime]);

            const Header = ({ title, sub, rightAction }) => (
                <header className="glass-header pt-14 pb-5 px-6 sticky top-0 z-50 flex justify-between items-end safe-top">
                    <div className="flex items-center gap-3">
                        <Icons.Logo />
                        <div>
                            <h1 className="text-xl font-bold text-[#e3e3e3] tracking-tight leading-none mb-1">{title}</h1>
                            <p className="text-[10px] text-[#9e9e9e] font-bold uppercase tracking-widest">{sub}</p>
                        </div>
                    </div>
                    {rightAction || (
                        <button onClick={() => setView(view === 'home' ? 'settings' : 'home')} className="p-3 bg-[#28292c] text-[#9e9e9e] rounded-full active:bg-[#3c4043]">
                            {view === 'home' ? <Icons.Settings /> : <Icons.X />}
                        </button>
                    )}
                </header>
            );

            if (view === 'settings') return (
                <div className="min-h-screen bg-[#131314]">
                    <Header title="Settings" sub="Sync Configuration" />
                    <main className="p-6 space-y-6">
                        <div className="p-6 rounded-[32px] dark-card space-y-4">
                            <label className="text-[10px] font-bold text-[#9e9e9e] uppercase tracking-widest block ml-1">Internal Secret Key</label>
                            <input type="password" value={notionKey} onChange={e => {setNotionKey(e.target.value); localStorage.setItem('notion_key', e.target.value);}} placeholder="secret_..." className="w-full p-4 bg-[#131314] text-white rounded-2xl border border-[#3c4043] text-sm outline-none" />
                        </div>
                        <button onClick={fetchExercisesFromNotion} disabled={syncStatus === 'syncing'} className="w-full py-5 bg-[#8ab4f8] text-[#131314] rounded-[24px] font-bold shadow-xl active:scale-95 transition-all">
                            {syncStatus === 'syncing' ? 'Syncing...' : 'Sync Notion Library'}
                        </button>
                        <div className="text-center opacity-30 text-[10px] font-bold uppercase tracking-[0.2em] pt-4">{VERSION}</div>
                    </main>
                </div>
            );

            if (view === 'home') return (
                <div className="min-h-screen bg-[#131314]">
                    <Header title="Gym Tracker" sub="Select Workout" />
                    <main className="p-6 space-y-4 pb-32">
                        {routines.map(r => (
                            <div key={r.id} className="p-5 rounded-[32px] dark-card flex items-center justify-between shadow-sm active:bg-[#28292c] transition-colors">
                                <div className="flex-1">
                                    <h3 className="text-lg font-bold text-[#e3e3e3] leading-tight">{r.name}</h3>
                                    <p className="text-[10px] text-[#9e9e9e] font-bold uppercase tracking-widest mt-1">{r.exercises.length} Exercises</p>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => { setActiveRoutine(r); setView('planner'); }} className="p-3 text-[#9e9e9e]"><Icons.Settings /></button>
                                    <button onClick={() => { setActiveRoutine(r); setCurrentExerciseIndex(0); setWorkoutLog({}); setView('active'); }} className="w-12 h-12 bg-[#8ab4f8] text-[#131314] rounded-[20px] flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                                        <Icons.Play />
                                    </button>
                                </div>
                            </div>
                        ))}
                        <button onClick={() => { const nr={id:Date.now(), name:"New Routine", exercises:[]}; setRoutines([...routines, nr]); setActiveRoutine(nr); setView('planner'); }} className="w-full py-10 border-2 border-dashed border-[#3c4043] rounded-[32px] flex flex-col items-center gap-2 text-[#9e9e9e] active:bg-[#1e1f20]">
                            <Icons.Plus />
                            <span className="text-[10px] font-bold uppercase tracking-widest">Add Program</span>
                        </button>
                    </main>
                </div>
            );

            if (view === 'planner') return (
                <div className="min-h-screen bg-[#131314] pb-48">
                    <Header title="Planner" sub="Sequence" rightAction={
                        <div className="flex items-center gap-2">
                            <button onClick={() => setShowConfirmDelete(!showConfirmDelete)} className={`p-3 rounded-full transition-colors ${showConfirmDelete ? 'bg-red-500 text-white' : 'bg-[#28292c] text-[#9e9e9e]'}`}>
                                <Icons.Trash />
                            </button>
                            <button onClick={() => setView('home')} className="p-3 bg-[#28292c] text-[#9e9e9e] rounded-full"><Icons.X /></button>
                        </div>
                    } />
                    <main className="p-6 space-y-6">
                        {showConfirmDelete && (
                            <div className="p-5 bg-red-900/20 border border-red-900/50 rounded-2xl animate-in fade-in zoom-in-95">
                                <p className="text-xs text-red-200 font-bold text-center mb-3 tracking-wide">Delete routine permanently?</p>
                                <div className="flex gap-2">
                                    <button onClick={deleteRoutine} className="flex-1 bg-red-600 text-white py-3 rounded-xl text-[10px] font-bold uppercase">Confirm Delete</button>
                                    <button onClick={() => setShowConfirmDelete(false)} className="flex-1 bg-[#131314] text-[#9e9e9e] py-3 rounded-xl text-[10px] font-bold uppercase border border-[#3c4043]">Keep it</button>
                                </div>
                            </div>
                        )}
                        <input value={activeRoutine.name} onChange={e => setActiveRoutine({...activeRoutine, name: e.target.value})} className="text-3xl font-bold text-[#e3e3e3] bg-transparent border-none outline-none w-full" placeholder="Routine Name" />
                        
                        <section>
                            <h4 className="text-[10px] font-bold text-[#9e9e9e] uppercase tracking-widest mb-3">Add Exercise</h4>
                            <div className="flex flex-wrap gap-2">
                                {notionExercises.map((ex, i) => (
                                    <button key={i} onClick={() => setActiveRoutine({...activeRoutine, exercises: [...activeRoutine.exercises, {id:Math.random().toString(36).substr(2,9), name:ex.name, defaultPause:ex.pause, targetSets:ex.sets, suggestedWeight: ex.weight, targetReps: 10}]})} className="px-3 py-2 bg-[#1e1f20] border border-[#3c4043] rounded-xl text-[11px] font-semibold text-[#e3e3e3] active:bg-[#8ab4f8] active:text-[#131314] flex items-center gap-2">
                                        <span className="bg-[#3c4043] px-1 rounded text-[8px] text-[#8ab4f8] font-black">{ex.tag}</span> {ex.name}
                                    </button>
                                ))}
                            </div>
                        </section>

                        <div className="space-y-3">
                            {activeRoutine.exercises.map((ex, i) => (
                                <div key={ex.id} className="p-4 dark-card rounded-[24px] space-y-4 shadow-sm">
                                    <div className="flex justify-between items-center">
                                        <span className="font-bold text-[#e3e3e3] text-sm">{ex.name}</span>
                                        <button onClick={() => { const n={...activeRoutine}; n.exercises.splice(i,1); setActiveRoutine(n); }} className="p-2 text-[#3c4043] active:text-red-500"><Icons.Trash /></button>
                                    </div>
                                    <div className="grid grid-cols-4 gap-2">
                                        <div>
                                            <span className="text-[8px] font-black text-[#9e9e9e] uppercase block mb-1 text-center">Sets</span>
                                            <input type="number" value={ex.targetSets} onChange={e => { const n={...activeRoutine}; n.exercises[i].targetSets=parseInt(e.target.value) || 1; setActiveRoutine(n); }} className="planner-input" />
                                        </div>
                                        <div>
                                            <span className="text-[8px] font-black text-[#9e9e9e] uppercase block mb-1 text-center">Reps</span>
                                            <input type="number" value={ex.targetReps} onChange={e => { const n={...activeRoutine}; n.exercises[i].targetReps=parseInt(e.target.value) || 1; setActiveRoutine(n); }} className="planner-input" />
                                        </div>
                                        <div>
                                            <span className="text-[8px] font-black text-[#9e9e9e] uppercase block mb-1 text-center">KG</span>
                                            <input type="number" step="0.5" value={ex.suggestedWeight} onChange={e => { const n={...activeRoutine}; n.exercises[i].suggestedWeight=parseFloat(e.target.value) || 0; setActiveRoutine(n); }} className="planner-input" />
                                        </div>
                                        <div>
                                            <span className="text-[8px] font-black text-[#9e9e9e] uppercase block mb-1 text-center">Rest</span>
                                            <input type="number" value={ex.defaultPause} onChange={e => { const n={...activeRoutine}; n.exercises[i].defaultPause=parseInt(e.target.value) || 0; setActiveRoutine(n); }} className="planner-input" />
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>
                    <footer className="fixed bottom-0 left-0 right-0 p-6 bg-[#131314]/90 backdrop-blur-md border-t border-[#28292c] pb-12 z-50 safe-bottom">
                        <button onClick={() => { setRoutines(routines.map(r => r.id === activeRoutine.id ? activeRoutine : r)); setView('home'); }} className="w-full py-5 bg-[#8ab4f8] text-[#131314] rounded-[24px] font-bold shadow-xl active:scale-95 transition-all uppercase tracking-widest text-xs italic">Save Protocol</button>
                    </footer>
                </div>
            );

            if (view === 'active') {
                const ex = activeRoutine.exercises[currentExerciseIndex];
                const logged = workoutLog[ex.id] || [];
                
                const adjustWeight = (v) => setInputWeight(prev => Math.max(0, parseFloat(prev) + v));
                const adjustReps = (v) => setInputReps(prev => Math.max(0, parseInt(prev) + v));

                return (
                    <div className="min-h-screen bg-[#131314]">
                        <Header title={ex.name} sub={`Step ${currentExerciseIndex + 1} of ${activeRoutine.exercises.length}`} />
                        <main className="p-6 space-y-10 pb-48">
                            <div className="flex gap-4">
                                <div className="flex-1 space-y-4">
                                    <div className="p-6 dark-card rounded-[32px] text-center shadow-sm relative">
                                        <span className="text-[10px] font-bold text-[#9e9e9e] uppercase tracking-widest block mb-2">Weight</span>
                                        <input type="number" step="0.5" value={inputWeight} onChange={e => setInputWeight(e.target.value)} className="text-4xl font-bold bg-transparent w-full text-center outline-none text-[#e3e3e3]" />
                                        <span className="text-[10px] font-black text-[#8ab4f8] absolute bottom-3 right-0 left-0 uppercase tracking-widest">Kilograms</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => adjustWeight(-2.5)} className="input-control-btn text-xs">-2.5</button>
                                        <button onClick={() => adjustWeight(2.5)} className="input-control-btn text-xs">+2.5</button>
                                        <button onClick={() => adjustWeight(-5)} className="input-control-btn">-5</button>
                                        <button onClick={() => adjustWeight(5)} className="input-control-btn">+5</button>
                                    </div>
                                </div>
                                <div className="flex-1 space-y-4">
                                    <div className="p-6 dark-card rounded-[32px] text-center shadow-sm relative">
                                        <span className="text-[10px] font-bold text-[#9e9e9e] uppercase tracking-widest block mb-2">Reps</span>
                                        <input type="number" value={inputReps} onChange={e => setInputReps(e.target.value)} className="text-4xl font-bold bg-transparent w-full text-center outline-none text-[#e3e3e3]" />
                                        <span className="text-[10px] font-black text-[#8ab4f8] absolute bottom-3 right-0 left-0 uppercase tracking-widest">Volume</span>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={() => adjustReps(-1)} className="flex-1 input-control-btn text-xl">-</button>
                                        <button onClick={() => adjustReps(1)} className="flex-1 input-control-btn text-xl">+</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setInputReps(8)} className="input-control-btn text-[10px]">8</button>
                                        <button onClick={() => setInputReps(12)} className="input-control-btn text-[10px]">12</button>
                                    </div>
                                </div>
                            </div>
                            
                            <button onClick={() => { 
                                const n = {...workoutLog}; if(!n[ex.id]) n[ex.id]=[]; 
                                n[ex.id].push({w: inputWeight, r: inputReps});
                                setWorkoutLog(n); startTimer(ex.defaultPause);
                            }} className="w-full py-6 bg-[#e3e3e3] text-[#131314] rounded-[28px] font-bold text-lg shadow-xl active:scale-[0.96] transition-all uppercase tracking-widest italic">Log Set {logged.length + 1}</button>
                            
                            <div className="flex flex-wrap gap-2">
                                {logged.map((s, i) => (
                                    <div key={i} className="px-4 py-2 bg-[#8ab4f8]/10 text-[#8ab4f8] rounded-2xl text-[10px] font-bold border border-[#8ab4f8]/20 animate-in fade-in zoom-in-95">SET {i+1}: {s.w}KG Ã— {s.r}</div>
                                ))}
                            </div>
                        </main>
                        {timerActive && (
                            <div className="fixed bottom-36 left-6 right-6 bg-[#e3e3e3] text-[#131314] p-5 rounded-[28px] shadow-2xl flex items-center justify-between z-50 animate-in fade-in slide-in-from-bottom-8">
                                <div className="flex items-center gap-4">
                                    <div className="animate-pulse-subtle"><Icons.Clock /></div>
                                    <span className="font-mono text-2xl font-bold tracking-tighter tabular-nums">{Math.floor(timeLeft/60)}:{(timeLeft%60).toString().padStart(2,'0')}</span>
                                </div>
                                <button onClick={() => {setTimerActive(false); setTargetEndTime(null);}} className="text-[10px] font-bold uppercase tracking-widest bg-[#131314]/10 px-4 py-2 rounded-xl">Skip Rest</button>
                            </div>
                        )}
                        <footer className="fixed bottom-0 left-0 right-0 p-6 bg-[#131314]/95 backdrop-blur-xl border-t border-[#28292c] pb-12 flex gap-4 z-40 safe-bottom">
                            <button disabled={currentExerciseIndex === 0} onClick={() => setCurrentExerciseIndex(i => i-1)} className="w-16 h-16 bg-[#28292c] rounded-[20px] flex items-center justify-center text-[#9e9e9e] disabled:opacity-20 active:bg-[#3c4043] transition-colors">
                                <Icons.ChevronLeft />
                            </button>
                            <button disabled={isLogging} onClick={async () => {
                                if (currentExerciseIndex === activeRoutine.exercises.length - 1) {
                                    await pushToNotionLog(); setView('home');
                                } else {
                                    setCurrentExerciseIndex(i => i + 1); setTimerActive(false); setTargetEndTime(null);
                                }
                            }} className={`flex-1 ${isLogging ? 'bg-amber-500' : 'bg-[#8ab4f8]'} text-[#131314] rounded-[20px] font-bold flex items-center justify-center gap-2 active:bg-[#a6c7f9] uppercase tracking-widest text-[11px] shadow-lg`}>
                                {isLogging ? 'Syncing...' : (currentExerciseIndex === activeRoutine.exercises.length - 1 ? 'Finish Session' : 'Next Exercise')} 
                                {!isLogging && <Icons.ChevronRight />}
                            </button>
                        </footer>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
